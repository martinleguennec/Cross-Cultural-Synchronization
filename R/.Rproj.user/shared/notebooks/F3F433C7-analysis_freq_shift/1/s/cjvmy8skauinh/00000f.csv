"0","x <- unname(df_freq_shift$q_20)"
"0","y <- unname(df_freq_shift$q_25)"
"0",""
"0","# observed statistic"
"0","d_obs <- mean(x - y)"
"0",""
"0","# permutation (unpaired shuffle). If paired, see note below."
"0","n_x <- length(x)"
"0","n_y <- length(y)"
"0","n_total <- n_x + n_y"
"0","pooled <- c(x, y)"
"0",""
"0","set.seed(42)"
"0","d_perm <- replicate(100000, {"
"0","  idx <- sample.int(n_total)"
"0","  x_idx <- idx[1:n_x]"
"0","  y_idx <- idx[(n_x + 1):(n_x + n_y)]"
"0","  x_star <- pooled[x_idx]"
"0","  y_star <- pooled[y_idx]"
"0","  mean(x_star - y_star)"
"0","})"
"0",""
"0","# two-sided p-value"
"0","p_value_two_sided <- mean(abs(d_perm) >= abs(d_obs))"
"0",""
"0","# dataframe for plotting"
"0","perm_df <- data.frame(perm = d_perm)"
"0",""
"0","# histogram with observed line and p-value text"
"0","ggplot(perm_df, aes(x = perm)) +"
"0","  geom_histogram(bins = 30) +"
"0","  geom_vline(xintercept = d_obs, linetype = ""dashed"") +"
"0","  annotate("
"0","    ""text"","
"0","    x = d_obs, y = Inf,"
"0","    label = sprintf(""Observed = %.3f\np = %.4f"", d_obs, p_value_two_sided),"
"0","    vjust = 1.5, hjust = -0.1"
"0","  ) +"
"0","  labs("
"0","    x = ""Permuted mean differences"","
"0","    y = ""Count"","
"0","    title = ""Permutation null for mean(x âˆ’ y)"""
"0","  )"
